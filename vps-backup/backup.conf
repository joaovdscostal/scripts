#!/bin/bash
# ============================================================================
# ARQUIVO DE CONFIGURAÇÃO DO SISTEMA DE BACKUP VPS
# ============================================================================
# Este arquivo contém todas as configurações customizáveis para o backup
# Edite este arquivo conforme suas necessidades antes de executar o backup

# ============================================================================
# CONFIGURAÇÕES GERAIS
# ============================================================================

# Diretório onde os backups serão armazenados
BACKUP_ROOT="/root/backup-vps/dados"

# Arquivo de log para execuções via cron (será sobrescrito a cada execução)
CRON_LOG_FILE="/root/backup-vps/ultimo_backup.log"

# Número de dias para manter backups antigos (0 = manter todos)
BACKUP_RETENTION_DAYS=1

# Compactar backups? (true/false)
COMPRESS_BACKUPS=true

# Enviar notificação por WhatsApp? (true/false)
SEND_WHATSAPP_NOTIFICATION=true
WHATSAPP_NUMBER="5522999604234"

# URL da API de WhatsApp
WHATSAPP_API_URL="http://137.184.190.52:8084/message/sendText/1ea41cef-c560-41a9-b25c-257a850560b3"
WHATSAPP_API_KEY="zYzP7ocstxh3Sscefew4FZTCu4ehnM8v4hu"

# ============================================================================
# MODO DE BACKUP (NOVO!)
# ============================================================================
# Escolha o que incluir no backup:
#
# "full"        = Backup completo (tudo)
# "infra"       = Apenas infraestrutura (sem banco e sem webapps do Tomcat)
# "database"    = Apenas banco de dados
# "webapps"     = Apenas webapps do Tomcat
#
# Deixe vazio ("") para usar as configurações individuais abaixo
BACKUP_MODE="infra"

# ============================================================================
# CONFIGURAÇÕES DE BANCO DE DADOS (MariaDB)
# ============================================================================

# Fazer backup de banco de dados? (true/false)
BACKUP_DATABASE=true

# Credenciais do MariaDB
DB_USER="root"
DB_PASSWORD="MuTk9xL2W9v"
DB_HOST="localhost"
DB_PORT="3306"

# Lista de bancos de dados para backup (separados por espaço)
# Deixe vazio para fazer backup de TODOS os bancos
# Exemplo: DB_LIST="banco1 banco2 banco3"
DB_LIST="cidadania-producao codetech-novo dimensao-api landing_pages multt"

# Excluir bancos específicos do backup (separados por espaço)
DB_EXCLUDE="information_schema performance_schema mysql sys"

# Usar mariabackup (backup físico - mais rápido) ou mysqldump (backup lógico)?
# Opções: "mariabackup" ou "mysqldump"
DB_BACKUP_METHOD="mariabackup"

# ============================================================================
# APLICAÇÕES SPRING BOOT (APIs Java 21)
# ============================================================================

# Fazer backup de aplicações Spring Boot? (true/false)
BACKUP_SPRINGBOOT=true

# Lista de aplicações Spring Boot
# Formato: "nome_app:caminho_diretorio_ou_jar:caminho_service"
#
# Você pode especificar:
#   - Um DIRETÓRIO (recomendado): Copia todo o conteúdo da pasta
#     Exemplo: "api-produtos:/opt/apps/api-produtos:/etc/systemd/system/api-produtos.service"
#
#   - Um ARQUIVO JAR: Copia apenas o JAR + arquivos de configuração (.properties/.yml)
#     Exemplo: "api-produtos:/opt/apps/api-produtos/app.jar:/etc/systemd/system/api-produtos.service"
#
SPRINGBOOT_APPS=(
    "dimensao-api:/root/apis/dimensao-api:/etc/systemd/system/dimensao-api.service"
    "api-images-s3:/root/apis/api-images-s3:/etc/systemd/system/api-image-s3.service"
    # "api-usuarios:/opt/apps/api-usuarios:/etc/systemd/system/api-usuarios.service"
    # Adicione mais aplicações aqui
)

# Diretórios de configuração Spring Boot adicionais (separados por espaço)
SPRINGBOOT_CONFIG_DIRS=""

# ============================================================================
# APACHE TOMCAT 9
# ============================================================================

# Fazer backup do Tomcat? (true/false)
BACKUP_TOMCAT=true

# Diretório de instalação do Tomcat
TOMCAT_HOME="/root/appservers/apache-tomcat-9"

# Fazer backup das webapps do Tomcat? (true/false)
# true  = Backup completo (tudo exceto logs, work, temp)
# false = Backup SEM webapps (tudo exceto logs, work, temp e webapps)
TOMCAT_BACKUP_WEBAPPS=true

# Fazer backup dos logs do Tomcat? (true/false)
BACKUP_TOMCAT_LOGS=false

# ============================================================================
# APLICAÇÕES NODE.JS (PM2)
# ============================================================================

# Fazer backup de aplicações Node.js? (true/false)
BACKUP_NODEJS=true

# Lista de aplicações Node.js gerenciadas pelo PM2
# Formato: "nome_app:caminho_aplicacao"
# Exemplo: "api-node:/opt/nodejs/api-node"
NODEJS_APPS=(
    "dimensao-web:/opt/dimensao-web"
    "landing-pages-backend:/var/www/nodejs/landing-pages-manager"
    # "api-websocket:/opt/nodejs/api-websocket"
    # Adicione mais aplicações aqui
)

# Fazer backup do arquivo de configuração do PM2? (true/false)
BACKUP_PM2_CONFIG=true

# Usuário que roda as aplicações PM2
PM2_USER="root"

# ============================================================================
# APLICAÇÕES ESTÁTICAS (HTML/CSS/JS)
# ============================================================================

# Fazer backup de aplicações estáticas? (true/false)
BACKUP_STATIC_APPS=true

# Lista de diretórios de aplicações estáticas
STATIC_APPS_DIRS=(
    "/var/www/vraptor-docs"
    # Adicione mais diretórios aqui
)

# ============================================================================
# NGINX
# ============================================================================

# Fazer backup do Nginx? (true/false)
BACKUP_NGINX=true

# Diretório de configuração do Nginx
NGINX_CONFIG_DIR="/etc/nginx"

# Fazer backup dos logs do Nginx? (true/false)
BACKUP_NGINX_LOGS=false

# Fazer backup dos certificados SSL (Certbot/Let's Encrypt)? (true/false)
BACKUP_SSL_CERTS=true

# Diretório dos certificados SSL
SSL_CERTS_DIR="/etc/letsencrypt"

# ============================================================================
# CONFIGURAÇÕES ADICIONAIS
# ============================================================================

# Fazer backup de cron jobs? (true/false)
BACKUP_CRON=true

# Fazer backup de configurações do sistema? (true/false)
BACKUP_SYSTEM_CONFIG=true

# Diretórios adicionais para backup (separados por espaço)
ADDITIONAL_DIRS=""

# ============================================================================
# SCRIPTS CUSTOMIZADOS
# ============================================================================

# Fazer backup de scripts customizados? (true/false)
BACKUP_CUSTOM_SCRIPTS=true

# Diretórios que contêm scripts customizados (separados por espaço)
CUSTOM_SCRIPTS_DIRS="/root/scripts"

# Fazer backup de arquivo de log dos scripts? (true/false)
BACKUP_SCRIPT_LOGS=false

# Diretório de logs dos scripts
SCRIPT_LOGS_DIR="/var/log/scripts"

# ============================================================================
# BACKUP REMOTO (OPCIONAL)
# ============================================================================

# Enviar backup para servidor remoto via rsync/scp? (true/false)
REMOTE_BACKUP=false

# Configurações do servidor remoto
REMOTE_USER="usuario"
REMOTE_HOST="backup.exemplo.com"
REMOTE_PATH="/backups/vps"
REMOTE_SSH_KEY="/root/.ssh/id_rsa"

# ============================================================================
# BACKUP PARA DIGITALOCEAN SPACES VIA RCLONE
# ============================================================================

# Enviar backup para DigitalOcean Spaces via rclone? (true/false)
S3_BACKUP=true

# Nome do remote configurado no rclone
# Execute: rclone config para configurar o remote do DigitalOcean Spaces
# Tipo: s3 (compatível com S3)
# Provider: DigitalOcean Spaces
# Endpoint: https://REGION.digitaloceanspaces.com (ex: nyc3.digitaloceanspaces.com)
RCLONE_REMOTE="codetech"

# Space e path no DigitalOcean Spaces
# Exemplo: Se seu Space se chama "meu-backup" e quer guardar em "backups/vps"
S3_BUCKET="codetech"
S3_PATH="backups/vps"

# Manter quantos backups no Spaces? (0 = manter todos)
S3_RETENTION_COUNT=10

# ============================================================================
# FIM DA CONFIGURAÇÃO
# ============================================================================
